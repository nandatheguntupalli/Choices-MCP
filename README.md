# Adorable Component Generator MCP Server

A standalone MCP server that replicates 21st.Dev's magic MCP functionality, allowing Cursor users to generate 5 variations of UI components through freestyle sandboxes with real-time gallery selection.

## Features

- üöÄ **Standalone MCP Server**: Completely separate from Adorable app builder functionality
- üîê **Integrated Authentication**: Uses existing Adorable app API key system
- üé® **5 Component Variations**: Generates Modern, Colorful, Corporate, Dark Theme, and Animated variations
- ‚ö° **Real-time Updates**: Live gallery updates via Redis pub/sub system
- üñºÔ∏è **Interactive Gallery**: Beautiful gallery interface for component selection
- üìã **Code Snippet Delivery**: Selected component code returned directly to Cursor IDE

## Architecture Overview

```
Cursor IDE (MCP Client)
       ‚Üì MCP Tool Call
Standalone MCP Server
       ‚Üì HTTP API Calls
Adorable App (Gallery + Auth)
       ‚Üì Real-time Updates
Component Gallery Interface
```

## Prerequisites

1. **Adorable App Running**: The Next.js Adorable app must be running on `http://localhost:3000`
2. **Database Setup**: PostgreSQL with the extended schema including component generation tables
3. **Redis Server**: For real-time communication between MCP server and gallery
4. **API Keys**:
   - Freestyle API key for component generation
   - Adorable API key for authentication

## Installation & Setup

### 1. Install Dependencies

```bash
cd mcp-server
npm install
```

### 2. Build the Server

```bash
npm run build
```

### 3. Environment Variables

Create a `.env` file in the `mcp-server` directory:

```bash
ADORABLE_BASE_URL=http://localhost:3000
ADORABLE_API_KEY=your_adorable_generated_mcp_api_key_here
```

**Important**: The MCP server only needs the API key generated by the Adorable app. All Freestyle and Anthropic API keys are managed by the Next.js Adorable app itself.

### 4. Database Migration

The database schema has been extended with new tables. Run migrations in the Adorable app:

```sql
-- Component Generation Session Status Enum
CREATE TYPE component_session_status AS ENUM ('pending', 'generating', 'completed', 'selected', 'expired');

-- Sandbox Status Enum
CREATE TYPE sandbox_status AS ENUM ('generating', 'completed', 'failed');

-- Framework Enum
CREATE TYPE framework_type AS ENUM ('react', 'vue', 'angular');

-- Styling Enum
CREATE TYPE styling_type AS ENUM ('tailwind', 'css', 'styled-components');

-- Component Generation Sessions table
CREATE TABLE component_generation_sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id TEXT NOT NULL,
  description TEXT NOT NULL,
  framework framework_type NOT NULL,
  styling styling_type NOT NULL,
  status component_session_status NOT NULL DEFAULT 'pending',
  selected_component_id UUID,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
  expires_at TIMESTAMP NOT NULL DEFAULT NOW() + INTERVAL '1 hour'
);

-- Sandbox Results table
CREATE TABLE sandbox_results (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id UUID NOT NULL REFERENCES component_generation_sessions(id) ON DELETE CASCADE,
  sandbox_index INTEGER NOT NULL,
  status sandbox_status NOT NULL DEFAULT 'generating',
  component_name TEXT,
  component_code TEXT,
  component_description TEXT,
  preview TEXT,
  dependencies JSONB,
  error TEXT,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW()
);

-- Component Selection Events table
CREATE TABLE component_selection_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  session_id UUID NOT NULL REFERENCES component_generation_sessions(id) ON DELETE CASCADE,
  component_id UUID NOT NULL REFERENCES sandbox_results(id) ON DELETE CASCADE,
  user_id TEXT NOT NULL,
  timestamp TIMESTAMP NOT NULL DEFAULT NOW()
);
```

## Usage

### 1. Start the Adorable App

```bash
cd Adorable
npm run dev
```

### 2. Start the MCP Server

```bash
cd mcp-server
npm run dev
```

### 3. Configure Cursor

The MCP server is already configured in `../../.cursor/mcp.json`:

```json
{
  "@adorable/component-generator-mcp": {
    "command": "node",
    "args": ["/path/to/mcp-server/dist/index.js"],
    "env": {
      "FREESTYLE_API_KEY": "your_key",
      "ADORABLE_BASE_URL": "http://localhost:3000",
      "ADORABLE_API_KEY": "your_adorable_api_key"
    }
  }
}
```

### 4. Use in Cursor

Ask Cursor to generate components using the MCP tools:

```
Generate pricing card components for my React app with Tailwind CSS
```

This will:

1. Call the `generate_component` MCP tool
2. Create a component generation session
3. Start 5 parallel freestyle sandbox generations
4. Open a gallery page at `http://localhost:3000/gallery/{sessionId}`
5. Show real-time progress as components generate
6. Allow you to select your preferred component
7. Return the selected component's code to Cursor

## Available MCP Tools

### `generate_component`

Generates 5 variations of a component and opens the gallery interface.

**Parameters:**

- `description` (required): Description of the component (e.g., "pricing cards", "login form")
- `framework` (optional): 'react' | 'vue' | 'angular' (default: 'react')
- `styling` (optional): 'tailwind' | 'css' | 'styled-components' (default: 'tailwind')

**Returns:**

- `sessionId`: Unique session identifier
- `galleryUrl`: URL to the component gallery
- `status`: 'created'

### `select_component`

Selects a component from the gallery and returns its code.

**Parameters:**

- `sessionId` (required): Session ID from generate_component
- `componentId` (required): ID of the component to select

**Returns:**

- `componentCode`: The complete component code
- `componentName`: Name of the component
- `framework`: Framework used
- `styling`: Styling approach used
- `dependencies`: Array of required dependencies

### `get_session_status`

Checks the status of a component generation session.

**Parameters:**

- `sessionId` (required): Session ID to check

**Returns:**

- `sessionId`: The session ID
- `status`: Current session status
- `completedComponents`: Number of completed components
- `totalComponents`: Total number of components (always 5)
- `expiresAt`: Session expiration time

## Component Variations

The system generates 5 distinct variations of each component:

1. **Modern/Minimal**: Clean lines, subtle shadows, professional colors
2. **Colorful/Creative**: Vibrant colors, gradients, playful elements
3. **Corporate/Professional**: Neutral colors, clear typography, business-oriented
4. **Dark Theme**: Dark backgrounds, light text, modern contrast
5. **Animated/Interactive**: Hover effects, transitions, dynamic animations

## Gallery Interface

The gallery interface provides:

- **Real-time Progress**: Live updates as components generate
- **Interactive Previews**: Click to select components
- **Code Viewing**: Toggle between preview and code view
- **Copy Functionality**: Copy component code to clipboard
- **Selection Feedback**: Clear indication of selected components
- **Session Management**: Automatic cleanup of expired sessions

## API Routes

The Adorable app includes new API routes for gallery functionality:

- `POST /api/mcp/validate` - Validate MCP API keys
- `POST /api/gallery/sessions` - Create generation sessions
- `GET /api/gallery/sessions/{sessionId}` - Get session data
- `PATCH /api/gallery/sessions/{sessionId}` - Update session
- `POST /api/gallery/sessions/{sessionId}/select` - Select component
- `POST /api/gallery/sessions/{sessionId}/sandbox` - Create sandbox result
- `PATCH /api/gallery/sandbox/{sandboxResultId}` - Update sandbox result

## Real-time Communication

Uses Redis pub/sub for real-time updates:

- **Channel Pattern**: `gallery:{sessionId}`
- **Message Types**: 'sandbox_started', 'sandbox_completed', 'sandbox_failed', 'component_selected'
- **Automatic Cleanup**: Expired sessions are automatically cleaned up

## Error Handling

Comprehensive error handling includes:

- **Authentication Errors**: Invalid API keys, expired sessions
- **Generation Failures**: Freestyle API errors, timeout handling
- **Network Issues**: Retry logic, graceful degradation
- **Session Management**: Expiration handling, cleanup processes

## Development

### Running Tests

```bash
npm test
```

### Development Mode

```bash
npm run dev
```

### Building

```bash
npm run build
```

## Production Deployment

1. **Build the MCP Server**: `npm run build`
2. **Set Environment Variables**: Configure production API keys and URLs
3. **Database Migration**: Apply schema changes to production database
4. **Redis Configuration**: Ensure Redis is available for real-time updates
5. **Update Cursor Configuration**: Point to production MCP server path

## Troubleshooting

### Common Issues

1. **MCP Server Not Connecting**
   - Check that the build is up to date: `npm run build`
   - Verify environment variables are set correctly
   - Ensure Adorable app is running and accessible

2. **Authentication Failures**
   - Verify ADORABLE_API_KEY is correct and active
   - Check that the API key has proper permissions
   - Ensure the Adorable app's MCP validation endpoint is working

3. **Gallery Not Loading**
   - Check that the Adorable app is running on the correct port
   - Verify database migrations have been applied
   - Check Redis connection for real-time updates

4. **Component Generation Failing**
   - Verify FREESTYLE_API_KEY is valid and has quota remaining
   - Check network connectivity to Freestyle API
   - Review server logs for specific error messages

### Logs

MCP server logs are output to console and include:

- Session creation and management
- Component generation progress
- Real-time broadcasting events
- Error details and stack traces

## License

MIT License - See LICENSE file for details.
